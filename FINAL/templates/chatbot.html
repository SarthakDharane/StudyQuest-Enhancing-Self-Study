<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot | SDL Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Game-inspired font */
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Exo 2', sans-serif;
        }
        
        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes glowing {
            0% { box-shadow: 0 0 5px rgba(66, 153, 225, 0.5); }
            50% { box-shadow: 0 0 20px rgba(66, 153, 225, 0.8); }
            100% { box-shadow: 0 0 5px rgba(66, 153, 225, 0.5); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .glow-effect {
            animation: glowing 2s infinite;
        }
        
        .pulse-effect {
            animation: pulse 2s infinite;
        }
        
        .bot-message, .user-message {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* Custom Scrollbar */
        #chat-window::-webkit-scrollbar {
            width: 8px;
        }
        
        #chat-window::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        #chat-window::-webkit-scrollbar-thumb {
            background: rgba(66, 153, 225, 0.6);
            border-radius: 10px;
            border: 2px solid rgba(0,0,0,0.05);
        }
        
        .dark #chat-window::-webkit-scrollbar-thumb {
            background: rgba(99, 179, 237, 0.6);
            border: 2px solid rgba(255,255,255,0.05);
        }
        
        /* Message bubbles with improved styling */
        .bot-message {
            position: relative;
            border-radius: 18px 18px 18px 4px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.2s;
            margin-bottom: 16px;
            border-left: 3px solid #4299e1;
        }
        
        .user-message {
            position: relative;
            border-radius: 18px 18px 4px 18px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.2s;
            margin-bottom: 16px;
            border-right: 3px solid #9f7aea;
        }
        
        /* Neo-futuristic background */
        .neo-grid {
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .dark .neo-grid {
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
        }
        
        /* Gaming progress bar */
        .progress-bar-container {
            height: 8px;
            width: 100%;
            background-color: rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            width: 75%;
            background: linear-gradient(90deg, #4299e1, #9f7aea);
            border-radius: 4px;
        }
        
        .dark .progress-bar-container {
            background-color: rgba(255,255,255,0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-indigo-950 transition-colors duration-300 neo-grid">
    
    <!-- Chat Container with increased overall padding -->
    <div class="flex flex-col items-center justify-center min-h-screen p-6">
        
        <!-- Chatbox with more generous sizing -->
        <div class="w-full max-w-4xl p-6 bg-white dark:bg-gray-800 shadow-2xl rounded-3xl transition-all duration-300 border-2 border-blue-200 dark:border-blue-900">
            
            <!-- Chat Header with improved vertical spacing and game elements -->
            <div class="flex items-center justify-between border-b-2 border-blue-200 dark:border-blue-800 pb-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center text-white glow-effect">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.25-11.25a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm1.47 7.72a.75.75 0 0 1-1.44 0l-.5-1.5a.75.75 0 1 1 1.44 0l.5 1.5z"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-blue-800 dark:text-blue-300"> N.E.R.V.  AI</h2>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-xs font-semibold bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 px-2 py-1 rounded-md">LEVEL 8</span>
                            <div class="progress-bar-container">
                                <div class="progress-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <span class="bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 py-1 px-3 rounded-full text-sm font-bold flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="mr-1">
                            <path d="M8 .625a.502.502 0 0 0-.447.276L4.132 8.5h7.736L8.447.901A.502.502 0 0 0 8 .625Z"/>
                            <path d="M13.764 9.5a.5.5 0 0 1-.372.833l-7.96 4.44A.502.502 0 0 1 4.5 14.5h5a.5.5 0 0 0 .5-.5V9.5Z"/>
                            <path d="M4.5 9.5a.5.5 0 0 0-.128.334l-2 6A.5.5 0 0 0 2.5 16h11a.5.5 0 0 0 .5-.5v-6a.5.5 0 0 0-.5-.5h-9Z"/>
                        </svg>
                        485
                    </span>
                    <button id="theme-toggle" onclick="toggleTheme()" class="p-3 rounded-xl bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-800 hover:from-gray-300 hover:to-gray-400 dark:hover:from-gray-600 dark:hover:to-gray-700 transition-colors duration-200 shadow-md">
                        <span class="block dark:hidden">🌙</span>
                        <span class="hidden dark:block">🌞</span>
                    </button>
                </div>
            </div>

            <!-- Chat Messages - Increased Height and padding -->
            <div id="chat-window" class="h-[500px] overflow-y-auto p-6 space-y-6 my-4 rounded-2xl bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-800 dark:to-indigo-950 border border-blue-100 dark:border-blue-900">
                <div class="bot-message text-left text-gray-800 dark:text-white p-5 bg-white dark:bg-gray-700 rounded-lg w-fit max-w-[80%] mr-auto">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-lg bg-blue-500 flex items-center justify-center text-white mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.25-11.25a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm1.47 7.72a.75.75 0 0 1-1.44 0l-.5-1.5a.75.75 0 1 1 1.44 0l.5 1.5z"/>
                            </svg>
                        </div>
                        <span class="font-bold text-blue-600 dark:text-blue-300"> N.E.R.V. AI</span>
                    </div>
                    Hello, adventurer! Welcome to the N.E.R.V. AI. How can I assist you on your quest today? 🚀
                </div>
            </div>

            <!-- Typing Indicator with better spacing -->
            <div id="typing-indicator" class="hidden text-blue-500 ml-3 mb-3 text-sm italic flex items-center">
                <div class="w-6 h-6 rounded-lg bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-300 mr-2 pulse-effect">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.25-11.25a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm1.47 7.72a.75.75 0 0 1-1.44 0l-.5-1.5a.75.75 0 1 1 1.44 0l.5 1.5z"/>
                    </svg>
                </div>
                AI is processing your request...
            </div>

            <!-- Input Box with improved spacing and gaming aesthetics -->
            <div class="flex items-center mt-6 bg-gradient-to-r from-gray-100 to-blue-50 dark:from-gray-700 dark:to-indigo-900 p-3 rounded-2xl border-2 border-blue-200 dark:border-blue-800 focus-within:ring-2 focus-within:ring-blue-400 transition-all shadow-md">
                <button id="mic-button" class="p-3 mx-1 text-gray-500 hover:text-blue-500 transition-colors bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 1a2 2 0 0 1 2 2v4a2 2 0 1 1-4 0V3a2 2 0 0 1 2-2zm3 5a3 3 0 0 0-6 0v1.5c0 1.3.639 2.383 1.631 3.063-.649.45-1.176 1.076-1.49 1.813-.225.55.05 1.187.6 1.412.55.226 1.187-.05 1.412-.6.318-.735.904-1.292 1.63-1.562A3.8 3.8 0 0 0 8 12c.382 0 .761-.036 1.126-.106.274-.052.643.004.925.145a1.26 1.26 0 0 1 .556.642.83.83 0 0 0 1.079.459c.42-.173.625-.65.451-1.07C11.535 10.966 10.33 10 9 10c-1.399 0-2.55.896-2.974 2.124-.07.206-.056.44.04.65l.101.25c.11.276.371.467.669.467h3.982a.75.75 0 0 0 0-1.5h-3.55c.248-.622.765-1.132 1.432-1.432A4 4 0 0 0 12 6.5 4 4 0 0 0 8 2.5 4 4 0 0 0 4 6.5v.5a3 3 0 0 0 6 0V6a3 3 0 0 0-6 0v5a.5.5 0 0 0 1 0V6a2 2 0 0 1 4 0v.5a2 2 0 1 1-4 0V6z"/>
                    </svg>
                </button>
                <input id="user-input" type="text" class="flex-1 bg-transparent outline-none px-4 py-3 text-black dark:text-white placeholder-gray-500 text-lg" placeholder="Type your command...">
                <button onclick="sendMessage()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all ml-2 shadow-md glow-effect font-bold">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="inline-block mr-2">
                        <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
                    </svg>
                    SEND
                </button>
            </div>
            <a href="/home" class="btn" style="margin-top: 10px; display: inline-block;"><button class="action-button">
                ⬅️ Return to Base
            </button></a>
            <!-- Status Bar at the bottom -->
            <div class="mt-5 flex justify-between text-xs text-gray-500 dark:text-gray-400 px-2">
                <div>STATUS: ONLINE</div>
                <div>POWER: 100%</div>
                <div>UPTIME: 12:45:33</div>
            </div>

        </div>
    </div>

    <script>
        function sendMessage() {
            const chatInput = document.getElementById("user-input");
            const userMessage = chatInput.value.trim();
            const messagesDiv = document.getElementById("chat-window");

            if (!userMessage) return; // Prevent sending empty messages

            // Append user message with improved spacing
            messagesDiv.innerHTML += `
                <div class="user-message text-right text-indigo-800 dark:text-indigo-200 font-semibold p-5 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900 dark:to-indigo-900 rounded-lg w-fit max-w-[80%] ml-auto">
                    <div class="flex items-center justify-end mb-2">
                        <span class="font-bold text-purple-600 dark:text-purple-300">YOU</span>
                        <div class="w-8 h-8 rounded-lg bg-purple-500 flex items-center justify-center text-white ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                            </svg>
                        </div>
                    </div>
                    ${userMessage}
                </div>
            `;

            chatInput.value = ""; // Clear input field
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to bottom

            // Show typing indicator
            const typingIndicator = document.getElementById("typing-indicator");
            typingIndicator.classList.remove("hidden");

            // Send message to backend
            fetch("/chatbot", {
                method: "POST",
                body: JSON.stringify({ message: userMessage }),
                headers: { "Content-Type": "application/json" }
            })
            .then(response => response.json())
            .then(data => {
                typingIndicator.classList.add("hidden"); // Hide typing indicator

                // Format bot response before displaying
                const formattedResponse = formatBotResponse(data.response);

                // Append bot response with better spacing
                messagesDiv.innerHTML += `
                    <div class="bot-message text-left text-gray-800 dark:text-white p-5 bg-white dark:bg-gray-700 rounded-lg w-fit max-w-[80%] mr-auto">
                        <div class="flex items-center mb-2">
                            <div class="w-8 h-8 rounded-lg bg-blue-500 flex items-center justify-center text-white mr-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.25-11.25a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm1.47 7.72a.75.75 0 0 1-1.44 0l-.5-1.5a.75.75 0 1 1 1.44 0l.5 1.5z"/>
                                </svg>
                            </div>
                            <span class="font-bold text-blue-600 dark:text-blue-300">AI NEXUS</span>
                        </div>
                        ${formattedResponse}
                    </div>
                `;

                messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to bottom
                
                // Add XP gain animation
                showXpGain();
            })
            .catch(error => {
                console.error("Error fetching chatbot response:", error);
                typingIndicator.classList.add("hidden");
                messagesDiv.innerHTML += `
                    <div class="bot-message text-red-500 p-5 bg-red-50 dark:bg-red-900 dark:text-red-100 rounded-lg w-fit max-w-[80%] mr-auto">
                        <div class="flex items-center mb-2">
                            <div class="w-8 h-8 rounded-lg bg-red-500 flex items-center justify-center text-white mr-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                </svg>
                            </div>
                            <span class="font-bold text-red-600 dark:text-red-300">ERROR</span>
                        </div>
                        Oops! Something went wrong with the connection. Please try again.
                    </div>
                `;
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            });
        }

        // Allow sending message with Enter key
        document.getElementById("user-input").addEventListener("keyup", function(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        });

        // Function to Format Chatbot Response
        function formatBotResponse(response) {
            // Convert *bold text* to <strong>bold text</strong>
            response = response.replace(/\*(.*?)\*/g, "<strong>$1</strong>");

            // Convert *** (triple asterisks) into line breaks
            response = response.replace(/\*\*\*/g, "<br>");

            // Replace * (single asterisks) with spaces
            response = response.replace(/\*/g, " ");

            return response;
        }

        // 🌙 Toggle Theme Function
        function toggleTheme() {
            const body = document.body;
            
            body.classList.toggle("dark");

            // Save the preference in localStorage
            localStorage.setItem("theme", body.classList.contains("dark") ? "dark" : "light");
        }
        
        // Show XP gain animation
        function showXpGain() {
            const xpBadge = document.createElement('div');
            xpBadge.className = 'fixed top-10 right-10 bg-green-600 text-white px-4 py-2 rounded-lg font-bold shadow-lg';
            xpBadge.textContent = '+15 XP';
            xpBadge.style.animation = 'fadeIn 0.5s, fadeOut 0.5s 2s forwards';
            
            // Add fade out animation
            document.styleSheets[0].insertRule(`
                @keyframes fadeOut {
                    from { opacity: 1; transform: translateY(0); }
                    to { opacity: 0; transform: translateY(-20px); }
                }
            `, document.styleSheets[0].cssRules.length);
            
            document.body.appendChild(xpBadge);
            
            // Remove after animation completes
            setTimeout(() => {
                document.body.removeChild(xpBadge);
            }, 2500);
        }

        // 🚀 Load Theme from Local Storage on Page Load
        window.onload = function () {
            const savedTheme = localStorage.getItem("theme");
            if (savedTheme === "dark") {
                document.body.classList.add("dark");
            }
            
            // Set random uptime counter for game effect
            const hours = Math.floor(Math.random() * 24);
            const minutes = Math.floor(Math.random() * 60);
            const seconds = Math.floor(Math.random() * 60);
            document.querySelector('.mt-5 div:nth-child(3)').textContent = 
                `UPTIME: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        };
    </script>

</body>
</html>